<idea-plugin>
    <id>io.repogate.plugin</id>
    <name>RepoGate</name>
    <vendor email="support@repogate.io" url="https://repogate.io">RepoGate</vendor>

    <description><![CDATA[
    RepoGate is a security plugin that monitors and validates dependencies before they are added to your project.
    
    <h3>Supported IDEs</h3>
    <ul>
      <li>IntelliJ IDEA (Ultimate & Community)</li>
      <li>PyCharm (Professional & Community)</li>
      <li>WebStorm</li>
      <li>PhpStorm</li>
      <li>RubyMine</li>
      <li>GoLand</li>
      <li>CLion</li>
      <li>Rider</li>
      <li>Android Studio</li>
    </ul>
    
    <h3>Features</h3>
    <ul>
      <li>Monitors package.json (npm), pom.xml (Maven), and build.gradle (Gradle) for dependency changes</li>
      <li>Validates dependencies against security vulnerabilities via RepoGate API</li>
      <li>EntraID SSO authentication with OAuth2 PKCE flow</li>
      <li>API Token authentication (legacy)</li>
      <li>Secure credential storage using IntelliJ PasswordSafe</li>
      <li>Automatic token refresh for EntraID sessions</li>
      <li>Git repository detection for enhanced security context</li>
      <li>Real-time dependency status monitoring</li>
      <li>In-IDE notifications for approval status</li>
    </ul>
    
    <h3>Authentication</h3>
    <p>Sign in using <strong>Tools > RepoGate > Sign In with EntraID</strong> (recommended) or API Token (legacy).</p>
    ]]></description>

       <change-notes><![CDATA[<h3>2.0.3</h3>
    <ul>
      <li><strong>EntraID Authentication Fix</strong> - Changed clientType from 'intellij' to 'jetbrains' to match backend expectations</li>
      <li><strong>Resolved "Invalid client type" Error</strong> - EntraID OAuth now works correctly</li>
    </ul>
    <h3>2.0.2</h3>
    <ul>
      <li><strong>Enhanced Settings UI</strong> - Authentication now integrated into Settings page</li>
      <li><strong>Sign In Buttons</strong> - Direct EntraID and API Token sign-in from Settings</li>
      <li><strong>Auth Status Display</strong> - Shows current authentication status and user email</li>
      <li><strong>Removed API Token Field</strong> - Authentication now handled securely via buttons</li>
      <li><strong>Better UX</strong> - Matches VS Code extension experience</li>
    </ul>
    <h3>2.0.1</h3>
    <ul>
      <li><strong>Compatibility Fix</strong> - Extended support to IntelliJ 2025.2+ (build 252.*)</li>
      <li><strong>Marketplace Compliance</strong> - Removed unnecessary optional dependencies</li>
      <li><strong>Simplified Dependencies</strong> - Only requires platform, Gradle, and Maven modules</li>
    </ul>
    <h3>2.0.0</h3>
    <ul>
      <li><strong>EntraID OAuth2 Authentication</strong> - Full SSO support with PKCE security</li>
      <li><strong>Dual Authentication Modes</strong> - EntraID SSO or API Token (legacy)</li>
      <li><strong>Secure Credential Storage</strong> - Uses IntelliJ PasswordSafe (encrypted)</li>
      <li><strong>Automatic Token Refresh</strong> - Background refresh for EntraID sessions</li>
      <li><strong>Multi-IDE Support</strong> - Compatible with all JetBrains IDEs</li>
      <li><strong>Enhanced API Integration</strong> - Aligned with VS Code extension</li>
      <li><strong>Git Repository Detection</strong> - Includes repository context in API calls</li>
      <li><strong>New User Actions</strong> - Sign In (EntraID/API Token), Sign Out, Account Info, Test Connection, Scan Now</li>
      <li><strong>Improved Security</strong> - No plain text token storage, PKCE flow, token rotation</li>
      <li><strong>Better Error Messages</strong> - Clear authentication and connection feedback</li>
    </ul>
    <h3>1.3.0</h3>
    <ul>
      <li>Added support for new /check endpoint status values</li>
      <li>New status: 'scanning' - Package is being scanned for vulnerabilities</li>
      <li>New status: 'not_found' - Package not found, submit request for review</li>
      <li>Improved status messages with icons (‚úì, ‚úó, ‚è≥, üîç, ‚ùì)</li>
      <li>Better handling of all approval workflow states</li>
      <li>Enhanced polling to handle scanning and not_found states</li>
      <li>Verified initial scan runs only once on first install</li>
    </ul>
    <h3>1.2.2</h3>
    <ul>
      <li>CRITICAL: Removed InventoryReporter that was triggering /request for all packages</li>
      <li>Initial scan now ONLY sends to /queue endpoint (no /request calls)</li>
      <li>Fixed duplicate package submission on startup</li>
      <li>Cleaned up unnecessary inventory reporting logic</li>
    </ul>
    <h3>1.2.1</h3>
    <ul>
      <li>Fixed threading issue in InitialPackageScanner causing IDE errors</li>
      <li>Fixed threading issue in InventoryReporter</li>
      <li>Wrapped file index access in ReadAction for proper thread safety</li>
      <li>Added node_modules filtering to prevent scanning dependencies</li>
      <li>Improved error logging and debugging output</li>
    </ul>
    <h3>1.2.0</h3>
    <ul>
      <li>Added initial package scan on first install/enable</li>
      <li>New /queue endpoint integration for existing packages</li>
      <li>Added packageVersion field to dependency requests</li>
      <li>Added projectName field to dependency requests</li>
      <li>Improved version extraction from all package managers</li>
      <li>Scan runs only once per project installation</li>
    </ul>
    <h3>1.1.1</h3>
    <ul>
      <li>Improved connection error handling with graceful retry logic</li>
      <li>Added friendly waiting messages when service is starting</li>
      <li>Automatic retry for up to 5 minutes when service is unavailable</li>
      <li>Clear success notification when connection is established</li>
      <li>Better user experience during service downtime</li>
    </ul>
    <h3>1.1.0</h3>
    <ul>
      <li>Added visual indicators for dependency approval status</li>
      <li>Implemented initial inventory reporting to RepoGate</li>
      <li>Added developer identification in API calls</li>
      <li>Improved notification messages with status icons</li>
      <li>Enhanced company visibility into developer dependency usage</li>
    </ul>
    <h3>1.0.1</h3>
    <ul>
      <li>Updated compatibility for IntelliJ IDEA 2024.3</li>
      <li>Extended support range to build 243.*</li>
    </ul>
    <h3>1.0.0</h3>
    <ul>
      <li>Initial release</li>
      <li>Support for npm, Maven, and Gradle dependency monitoring</li>
      <li>REST API integration for security validation</li>
      <li>Configuration UI for API token</li>
    </ul>
    ]]></change-notes>

    <!-- Product and plugin compatibility requirements -->
    <!-- Base platform module - required for all JetBrains IDEs -->
    <depends>com.intellij.modules.platform</depends>
    
    <!-- Optional dependencies for specific package manager support -->
    <!-- Gradle support (optional) -->
    <depends optional="true" config-file="repogate-gradle.xml">org.jetbrains.plugins.gradle</depends>
    <!-- Maven support (optional) -->
    <depends optional="true" config-file="repogate-maven.xml">org.jetbrains.idea.maven</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level settings -->
        <applicationConfigurable 
            parentId="tools" 
            instance="io.repogate.plugin.settings.RepoGateConfigurable"
            id="io.repogate.plugin.settings.RepoGateConfigurable"
            displayName="RepoGate"/>
        <applicationService 
            serviceImplementation="io.repogate.plugin.settings.RepoGateSettings"/>
        <applicationService 
            serviceImplementation="io.repogate.plugin.auth.AuthManager"/>
        
        <!-- Notification group -->
        <notificationGroup id="RepoGate Notifications" displayType="BALLOON" isLogByDefault="true"/>
    </extensions>

    <projectListeners>
        <listener class="io.repogate.plugin.listeners.DependencyFileListener"
                  topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"/>
    </projectListeners>

    <actions>
        <!-- RepoGate Actions -->
        <group id="RepoGate.Menu" text="RepoGate" description="RepoGate Actions" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            
            <!-- Authentication Actions -->
            <action id="RepoGate.SignInEntraID" 
                    class="io.repogate.plugin.actions.SignInEntraIDAction" 
                    text="Sign In with EntraID" 
                    description="Sign in to RepoGate using EntraID SSO"/>
            
            <action id="RepoGate.SignInAPIToken" 
                    class="io.repogate.plugin.actions.SignInAPITokenAction" 
                    text="Sign In with API Token (Legacy)" 
                    description="Sign in to RepoGate using API token"/>
            
            <action id="RepoGate.SignOut" 
                    class="io.repogate.plugin.actions.SignOutAction" 
                    text="Sign Out" 
                    description="Sign out from RepoGate"/>
            
            <action id="RepoGate.ShowAccountInfo" 
                    class="io.repogate.plugin.actions.ShowAccountInfoAction" 
                    text="Show Account Info" 
                    description="Show current account information"/>
            
            <separator/>
            
            <!-- Utility Actions -->
            <action id="RepoGate.TestConnection" 
                    class="io.repogate.plugin.actions.TestConnectionAction" 
                    text="Test Connection" 
                    description="Test connection to RepoGate API"/>
            
            <action id="RepoGate.ScanNow" 
                    class="io.repogate.plugin.actions.ScanNowAction" 
                    text="Scan Now" 
                    description="Manually scan all packages"/>
        </group>
    </actions>
</idea-plugin>
